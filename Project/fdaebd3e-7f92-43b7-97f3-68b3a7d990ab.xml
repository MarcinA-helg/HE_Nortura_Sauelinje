<StructuredTextModel xmlns="http://schemas.datacontract.org/2004/07/Omron.Cxap.Modules.StructuredText.Core" xmlns:i="http://www.w3.org/2001/XMLSchema-instance"><Text>//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------&#xD;
//	NAME:					HE_RT100SendSMSCmd&#xD;
//	CREATOR:				Helgevold - Jan Magne Dybvik&#xD;
// REQUIREMENTS: NX CPU&#xD;
//&#xD;
// DESCRTIPTION: 	Build  send SMS command string, with phone numbers and message&#xD;
//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------&#xD;
//  VERSION LOG:&#xD;
//	 VERSION			DATE				SIGN						DESCRIPTION&#xD;
//	 1.0					2025-03-31		Jan Magne Dybvik	Initial release&#xD;
//  1.1					2025-05-28		Jan Magne Dybvik	Bugfix: skip empty phonenumber string&#xD;
//  1.2					2025-06-24		Jan Magne Dybvik	Increased string lengths from 256 to 1986&#xD;
//  1.3					2025-06-24		Jan Magne Dybvik	Added replacement of slashes in SMS string&#xD;
//	 1.4					2025-07-03		Jan Magne Dybvik	Added more cases of percent encoding&#xD;
//  1.5					2025-07-04		Jan Magne Dybvik	Replaced Percent Encoding section with HE_PercentEncoding function&#xD;
//&#xD;
//================================================================================================================================&#xD;
&#xD;
// Initialize varialbes&#xD;
Wrk_arr_lb := LOWER_BOUND(Ext_PhoneNumbers,1);&#xD;
Wrk_arr_ub := UPPER_BOUND(Ext_PhoneNumbers,1);&#xD;
Wrk_size := Wrk_arr_ub - Wrk_arr_lb + 1;&#xD;
Wrk_Command := '/SMS/';&#xD;
&#xD;
// Add phone numbers&#xD;
FOR Wrk_i := 0 TO Wrk_size-1 DO&#xD;
	IF LEN(Ext_PhoneNumbers[Wrk_arr_lb + Wrk_i]) &gt; 0 THEN&#xD;
	    Wrk_Command := CONCAT(In1:=Wrk_Command, In2:=Ext_PhoneNumbers[Wrk_arr_lb + Wrk_i]);&#xD;
		IF Wrk_i &lt; Wrk_size-1 THEN&#xD;
			Wrk_Command := CONCAT(In1:=Wrk_Command, In2:=',');&#xD;
		END_IF;&#xD;
	END_IF;&#xD;
END_FOR;&#xD;
Wrk_Command := CONCAT(In1:=Wrk_Command, In2:='/');&#xD;
&#xD;
Val_Error := 0;&#xD;
HE_RT100SendSMSCmd :=  CONCAT(In1:=Wrk_Command, In2:= HE_PercentEncoding(Inp_Message));</Text></StructuredTextModel>