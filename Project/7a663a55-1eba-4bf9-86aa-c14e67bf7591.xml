<StructuredTextModel xmlns="http://schemas.datacontract.org/2004/07/Omron.Cxap.Modules.StructuredText.Core" xmlns:i="http://www.w3.org/2001/XMLSchema-instance"><Text>//------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ &#xD;
//	NAME:			Fôring - Felles                                                                                                                                                                                                                                                                            &#xD;
//	CREATOR:		Helgevold - William Veim                                                                                                                                                                                                                                                              &#xD;
//                                                                                                                                                                                                                                                                                                                            &#xD;
//------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ &#xD;
//  VERSION LOG:                                                                                                                                                                                                                                                                                                   &#xD;
//	VERSION		DATE				SIGN						DESCRIPTION                                                                                                                                                                                                                                 &#xD;
//	1.0.0			2024-04-08			William Veim			Initial release   &#xD;
//	1.0.1			2024-04-27			William Veim			Buxfix AVG weight calculation   &#xD;
//	1.0.2			2024-05-08			William Veim			Lagt til egendefinerte fôrplaner &#xD;
//&#xD;
//===============================================================================================================================&#xD;
//&#xD;
//		FUNKSJONALITET:&#xD;
//		*Kalkulerer felles parameter for fôring&#xD;
//			-Total biomasse idag&#xD;
//			-Total biomasse imorgen&#xD;
//			-Total snittvekt&#xD;
//			-Total antall dødfisk&#xD;
//			-Total antall fisk&#xD;
//&#xD;
//==============================================================================================================================&#xD;
Current_Time := TruncTod(DT_TO_TOD(In:=GetTime()), _SEC); // Henter gjeldende tid&#xD;
Current_TimeSeconds := TodToSec(Current_Time); // Konverter tid til sekunder&#xD;
Current_TimeSecondsConverted := LINT_TO_DINT(Current_TimeSeconds);&#xD;
ConvertHours := Current_TimeSecondsConverted / 3600; // 3600 sekunder per time&#xD;
ConvertMinutes := ((Current_TimeSecondsConverted MOD 3600) / 60) * 100 / 60; // Konverter minutter til området 0-100&#xD;
Foring_Felles.EXT_Operator.FeedCol_TimeToInt := ConvertHours * 100 + ConvertMinutes; // Konverter timer og minutter til heltall i formatet HHMM&#xD;
&#xD;
//Kalkulerer størrelse på "ST_Foring" array&#xD;
Wrk_TableSize_LB := LOWER_BOUND(ARR:=Foring_Array, DIM:=1);&#xD;
Wrk_TableSize_UB := UPPER_BOUND(ARR:=Foring_Array, DIM:=1);&#xD;
Wrk_TableSize:= DINT_TO_UINT(Wrk_TableSize_UB - Wrk_TableSize_LB + 1);&#xD;
&#xD;
IF Wrk_TableSize &gt; 1 THEN&#xD;
	//Resetter verider&#xD;
	Foring_Felles.EXT_Operator.Biomass_Total_Current :=0;&#xD;
	Foring_Felles.EXT_Operator.Biomass_Total_Tomorrow :=0;&#xD;
	Foring_Felles.EXT_Operator.DeadFish_Total :=0;&#xD;
	Foring_Felles.EXT_Operator.Fish_Total :=0;&#xD;
	Foring_Felles.EXT_Operator.Weight_AVG_Total :=0;&#xD;
	&#xD;
	//Summerer opp&#xD;
	FOR Wrk_IndexA:=DINT_TO_UINT(Wrk_TableSize_LB) TO Wrk_TableSize-1 DO&#xD;
		Foring_Felles.EXT_Operator.Biomass_Total_Current := Foring_Felles.EXT_Operator.Biomass_Total_Current + Foring_Array[Wrk_IndexA].EXT_Operator.Biomass_Current;&#xD;
		Foring_Felles.EXT_Operator.Biomass_Total_Tomorrow := Foring_Felles.EXT_Operator.Biomass_Total_Tomorrow+ Foring_Array[Wrk_IndexA].EXT_Operator.Biomass_Tomorrow;&#xD;
		Foring_Felles.EXT_Operator.DeadFish_Total := Foring_Felles.EXT_Operator.DeadFish_Total + Foring_Array[Wrk_IndexA].EXT_Statistics.Amount_Deadfish_Total;&#xD;
		Foring_Felles.EXT_Operator.Fish_Total := Foring_Felles.EXT_Operator.Fish_Total + Foring_Array[Wrk_IndexA].EXT_Operator.Amount_Fish;&#xD;
	END_FOR;&#xD;
	Foring_Felles.EXT_Operator.Weight_AVG_Total := (Foring_Felles.EXT_Operator.Biomass_Total_Current * 1000000.0) / Foring_Felles.EXT_Operator.Fish_Total;&#xD;
END_IF;&#xD;
&#xD;
&#xD;
RE_SecondPulse(Clk:=Get1sClk());&#xD;
//Henter aktuell søyle (index for søyle)&#xD;
IF RE_SecondPulse.Q THEN&#xD;
	FeedCol_Time_Start := SecToTod(0);&#xD;
	FeedCol_Time_End := SecToTod(1800);&#xD;
	FOR Wrk_FeedCol_Index:=0 TO 47 DO&#xD;
		IF Current_Time &gt; FeedCol_Time_Start AND Current_Time &lt; FeedCol_Time_End THEN&#xD;
			Foring_Felles.EXT_Operator.FeedCol_Actual:= Wrk_FeedCol_Index;&#xD;
			EXIT; &#xD;
		ELSE&#xD;
			FeedCol_Time_Start:= ADD_TOD_TIME(FeedCol_Time_Start, TIME#30m);&#xD;
			FeedCol_Time_End:= ADD_TOD_TIME(FeedCol_Time_End, TIME#30m);&#xD;
		END_IF;&#xD;
	END_FOR;&#xD;
END_IF;&#xD;
</Text></StructuredTextModel>