<StructuredTextModel xmlns="http://schemas.datacontract.org/2004/07/Omron.Cxap.Modules.StructuredText.Core" xmlns:i="http://www.w3.org/2001/XMLSchema-instance"><Text>//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------&#xD;
//	NAME:						Rate Of Change&#xD;
//	CREATOR:					Helgevold - Jan Magne Dybvik&#xD;
// REQUIREMENTS: 		NX CPU&#xD;
//&#xD;
//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------&#xD;
//  VERSION LOG:&#xD;
//	 VERSION			DATE				SIGN							DESCRIPTION&#xD;
//	 1.0.0				2023-11-07		Jan Magne Dybvik		Initial release&#xD;
//	 2.0.0				2025-03-25		William Veim				Rework&#xD;
//&#xD;
//================================================================================================================================&#xD;
//&#xD;
//			DESCRTIPTION: 	&#xD;
//			Calculates change in value over a time periode&#xD;
//		&#xD;
//===============================================================================================================================&#xD;
&#xD;
// Initialize&#xD;
IF wrk_firstCycle THEN&#xD;
	wrk_ValueLast := Inp;&#xD;
	wrk_TimeSinceLastSample := T#0s;&#xD;
	wrk_RateOfChange := 0.0;&#xD;
	wrk_firstCycle := FALSE;&#xD;
END_IF;&#xD;
&#xD;
// Increment state time&#xD;
wrk_TaskTime := GetMyTaskInterval();&#xD;
wrk_TimeSinceLastSample :=  ADD_TIME(In1:=wrk_TimeSinceLastSample, In2:=wrk_TaskTime);&#xD;
 &#xD;
IF wrk_TimeSinceLastSample &gt;= Cfg_SampleInterval THEN&#xD;
&#xD;
	// Calculate value differance from last call&#xD;
	wrk_ValueDiff := Inp - wrk_ValueLast;&#xD;
	// Store input value from last call&#xD;
	wrk_ValueLast := Inp;&#xD;
&#xD;
	wrk_TimeFactor := 1000000000.0 / LINT_TO_REAL(TimeToNanoSec(wrk_TimeSinceLastSample));&#xD;
	wrk_RateOfChange := wrk_ValueDiff * wrk_TimeFactor;&#xD;
&#xD;
	wrk_TimeSinceLastSample := T#0s;&#xD;
	&#xD;
END_IF;&#xD;
&#xD;
// Output rate of change&#xD;
Val := wrk_RateOfChange;</Text></StructuredTextModel>