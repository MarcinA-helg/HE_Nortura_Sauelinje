<StructuredTextModel xmlns="http://schemas.datacontract.org/2004/07/Omron.Cxap.Modules.StructuredText.Core" xmlns:i="http://www.w3.org/2001/XMLSchema-instance"><Text>//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------&#xD;
//	NAME:				HE_ATV_Drive_State&#xD;
//	CREATOR:			Helgevold - Jan Magne Dybvik&#xD;
//&#xD;
// REQUIREMENTS: Schneider ATV320 / ATV650&#xD;
// DESCRTIPTION: 	Generer en string med Frekvensomformerens modus/tilstand&#xD;
//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------&#xD;
//  VERSION LOG:&#xD;
//	 VERSION			DATE				SIGN						DESCRIPTION&#xD;
//	 1.0					2023-11-27		Jan Magne Dybvik	Initial release&#xD;
//&#xD;
//================================================================================================================================&#xD;
&#xD;
&#xD;
// Initilize&#xD;
Wrk_FaultValue := WORD_TO_UINT(Inp_HMIS);&#xD;
Wrk_StateString := '';&#xD;
Wrk_StateDescription := '';&#xD;
WRK_StateCode := '';&#xD;
&#xD;
Wrk_HMIS_Value := INT_TO_STRING(Wrk_FaultValue);&#xD;
&#xD;
CASE Wrk_FaultValue OF&#xD;
	0:&#xD;
		WRK_StateCode := 'TUN';&#xD;
		Wrk_StateDescription := 'Drive automatic tuning';&#xD;
	1:&#xD;
		WRK_StateCode := 'DCB';&#xD;
		Wrk_StateDescription := 'DC inj braking';&#xD;
	2:&#xD;
		WRK_StateCode := 'RDY';&#xD;
		Wrk_StateDescription := 'Drive Ready';&#xD;
	3:&#xD;
		WRK_StateCode := 'NST';&#xD;
		Wrk_StateDescription := 'Freewheel stop';&#xD;
	4:&#xD;
		WRK_StateCode := 'RUN';&#xD;
		Wrk_StateDescription := 'Running';&#xD;
	5:&#xD;
		WRK_StateCode := 'ACC';&#xD;
		Wrk_StateDescription := 'Accelerating';&#xD;
	6:&#xD;
		WRK_StateCode := 'DEC';&#xD;
		Wrk_StateDescription := 'Decelerating';&#xD;
	7:&#xD;
		WRK_StateCode :='CLI';&#xD;
		Wrk_StateDescription := 'Current limit';&#xD;
	8:&#xD;
		WRK_StateCode :='FST';&#xD;
		Wrk_StateDescription := 'Fast stop';&#xD;
	9:&#xD;
		WRK_StateCode :='FLU';&#xD;
		Wrk_StateDescription :='Fluxing motor';&#xD;
	11:&#xD;
		WRK_StateCode := 'NLP';&#xD;
		Wrk_StateDescription := 'No mains voltage';&#xD;
	12:&#xD;
		WRK_StateCode := 'PRA';&#xD;
		Wrk_StateDescription := 'Drive in power removal';&#xD;
	13:&#xD;
		WRK_StateCode := 'CTL';&#xD;
		Wrk_StateDescription := 'Control stopping';&#xD;
	14:&#xD;
		WRK_StateCode := 'OBR';&#xD;
		Wrk_StateDescription :=  'Dec ramp adaptation';&#xD;
	15:&#xD;
		WRK_StateCode := 'SOC';&#xD;
		Wrk_StateDescription :=  'Output cut';&#xD;
	17:&#xD;
		WRK_StateCode := 'USA';&#xD;
		Wrk_StateDescription := 'Undervoltage alarm';&#xD;
	18:&#xD;
		WRK_StateCode := 'TC';&#xD;
		Wrk_StateDescription := 'Drive test in progress';&#xD;
	19:&#xD;
		WRK_StateCode := 'ST';&#xD;
		Wrk_StateDescription := 'In autotest';&#xD;
	20:&#xD;
		WRK_StateCode := 'FA';&#xD;
		Wrk_StateDescription := 'Autotest error';&#xD;
	21:&#xD;
		WRK_StateCode := 'OK';&#xD;
		Wrk_StateDescription := 'Autotest OK';&#xD;
	22:&#xD;
		WRK_StateCode := 'EP';&#xD;
		Wrk_StateDescription := 'Eeprom test';&#xD;
	23:&#xD;
		WRK_StateCode := 'FLT';&#xD;
		Wrk_StateDescription := 'Drive in Fault';&#xD;
	25:&#xD;
		WRK_StateCode :=  'DCP';&#xD;
		Wrk_StateDescription := 'DCP Flashing mode';&#xD;
	28:&#xD;
		WRK_StateCode := 'SS1';&#xD;
		Wrk_StateDescription := 'Safe Stop 1';&#xD;
	29:&#xD;
		WRK_StateCode := 'SLS';&#xD;
		Wrk_StateDescription := 'Safely Limited Speed';&#xD;
	30:&#xD;
		WRK_StateCode := 'STO';&#xD;
		Wrk_StateDescription := 'Emergency Stop';&#xD;
	31: &#xD;
		WRK_StateCode := 'SMS';&#xD;
		Wrk_StateDescription := 'Safe Maximum Speed';&#xD;
	32: &#xD;
		WRK_StateCode := 'GDL';&#xD;
		Wrk_StateDescription := 'Guard Door Locking';&#xD;
	35: &#xD;
		WRK_StateCode := 'IDLE';&#xD;
		Wrk_StateDescription := 'Energy Saving';&#xD;
	36: &#xD;
		WRK_StateCode := 'FWUP';&#xD;
		Wrk_StateDescription := 'Firmware Update';&#xD;
	37: &#xD;
		WRK_StateCode := 'URA';&#xD;
		Wrk_StateDescription := 'AFE Mains undervoltage';&#xD;
		&#xD;
ELSE&#xD;
	WRK_StateCode := '???';&#xD;
	Wrk_StateDescription := 'Unkown State';&#xD;
&#xD;
END_CASE;&#xD;
&#xD;
&#xD;
&#xD;
&#xD;
// Add HMIS Code&#xD;
IF TestABit(In:=Cfg_Composition, Pos:=0) THEN&#xD;
	Wrk_StateString := CONCAT(Wrk_StateString, Wrk_HMIS_Value);&#xD;
END_IF;	&#xD;
&#xD;
&#xD;
// Add State Code&#xD;
IF TestABit(In:=Cfg_Composition, Pos:=1) THEN&#xD;
	IF LEN(Wrk_StateString) &gt; 0 THEN&#xD;
		Wrk_StateString := CONCAT(Wrk_StateString, Cfg_Delimiter);&#xD;
	END_IF;&#xD;
	Wrk_StateString := CONCAT(Wrk_StateString, WRK_StateCode);&#xD;
END_IF;&#xD;
&#xD;
// Add State Description&#xD;
IF TestABit(In:=Cfg_Composition, Pos:=2) THEN&#xD;
	IF LEN(Wrk_StateString) &gt; 0 THEN&#xD;
		Wrk_StateString := CONCAT(Wrk_StateString, Cfg_Delimiter);&#xD;
	END_IF;&#xD;
	Wrk_StateString := CONCAT(Wrk_StateString, Wrk_StateDescription);&#xD;
END_IF;&#xD;
&#xD;
HE_ATV_Drive_State := Wrk_StateString;</Text></StructuredTextModel>